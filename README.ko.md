# 미세먼지의 신호

## 목차

- [개요](#개요)
- [컨셉 도출하기](#컨셉-도출하기)
- [컨셉 구체화하기](#컨셉-구체화하기)
- [구현하기](#구현하기)
- [결과물](#결과물)

## 개요

### 통계 데이터로부터 찾아낸 미세먼지의 신호와 패턴

우리는 자연 현상을 너무 과학적으로 해석해온 것이 아닐까? 이 프로젝트는 미세먼지 현상을 자연이 주는 신호로 바라보는 관점에서 시작한다. 그 방법으로 미세먼지 데이터를 2진 신호로 변환하고, 웹 기술을 통해 시각과 청각적 요소로 표현한다. 이를 통해 체험자는 눈과 귀를 통해 미세먼지의 패턴을 찾아가는 사색의 시간을 보내게 된다. 최종적으로, 체험자가 데이터마다 각기 다른 신호가 발생하고 있음을 인지하고, 자연이 어떤 메시지를 전달하고 있는지 발견해나가길 기대해본다.

## 컨셉 도출하기

### 자연은 미세먼지를 통해 우리에게 무엇을 얘기하고 싶을까?

> 순순히 어두운 밤을 받아들이지 마시오. 빛이 꺼져감에 분노하고 또 분노하시오. (Do not go gentle into that good night. Rage, rage against the dying of the light.)

영화 <인터스텔라> 속 지구는 먼지로 뒤덮혀 생명체가 살아가기 어려운 환경이 되어있다. 많은 작물들이 병충해로 죽고, 인간들은 각종 기관지 질환에 시달린다. 살아남은 사람들은 이 지구가 자신들을 버렸다며 체념하고, 이대로 살다가 죽기를 기다린다.

주인공 쿠퍼와 동료들은 자기 자식과 가족, 그리고 인류를 구하기 위해 다른 지구를 찾아 나서는 여정을 떠난다. 결국, 쿠퍼가 자식을 사랑하는 마음이 중력을 통해 시공간을 초월했고, 그를 성간 우주로 이끌었고, 또 딸 머피가 말하는 유령(다른 차원의 존재)으로 다가와 중력 방정식을 풀 수 있는 데이터를 전달했다.

영화는 딜런 토머스의 시 문구를 인용해 우리에게 현재에 순응하지 말고, 자신을 속이지 말라고 한다. 저항하고 부딪히고 분노하라는 메시지를 전한다.

매일 미세먼지를 마주하는 우리도 나름대로 이겨내보기 위해 여러 노력을 해왔다. 미세먼지 측정 수치를 바탕으로 미세먼지가 얼마나 심한가, 그 원인이 무엇인가 등에 대해 초점을 맞추는 식이다.

하지만 인간 편의를 위해 측정하는 데이터가 아니라, 영화 <인터스텔라>처럼 자연이 현상을 통해 계속해서 데이터를 보내고 있다고 바라본다면 어떨까? 자연 현상을 측정하고 소비하는 입장이 아니라 제공자로서 바라본다면 어떤 방식으로, 어떤 신호로 보내고 있을까? 미세먼지 데이터를 통해 우리에게 어떤 메시지를 전달하려 할까?

### 데이터를 신호로 바라보자

> 비트에서 존재로 (It from bit) - 제임스 글릭, ≪인포메이션≫ 中

우주 모든 물질은 비트(bit), 즉 원자와 진공의 합으로 이루어진다. 그리고 비트(bit)는 전산에서 정보의 최소 단위로 사용되며, 우리는 이를 0과 1로 표현한다. 모든 수는 물론 텍스트, 이미지, 그리고 영상도 비트로 연산, 저장, 그리고 통신된다. 이런 관점에서 데이터를 비트(bit)로 표현해본다면 인간의 관습으로부터 멀리 떨어져 보다 본질에 가까이 바라볼 수 있지 않을까하는 생각이 들게 됐다.

> 관습에 의해 달고, 관습에 의해 쓰며, 관습에 의해 뜨겁고, 관습에 의해 차갑다. 색깔 역시 관습에 의한 것이다. 실제로 존재하는 것은 원자와 진공 뿐이다. - 데모크리토스

이제 미세먼지 데이터를 보자. 우리가 심한 정도를 판단할 때 사용하는 미세먼지 수치는 공간 내 입자 밀도(㎍/㎥)로 측정한다. 기존 시각으로 바라봤던 미세먼지 수치를 이제 비트(bit)로 바라본다면 어떨까. 어떤 신호가 있지 않을까? 어쩌면 색다른 관점을 얻을 수 있지 않을까라는 기대를 하게 된다.

시각화 아이디어를 얻기 위해, 영화 <인터스텔라> 속 주인공 쿠퍼가 딸 머피에게 정보를 어떻게 비트(bit) 신호로 전달하는가를 살펴봤다. 머피가 유령이라 여기던 다른 차원의 쿠퍼 자신은 머피에게 데이터를 전달할 수 있는 여러 가지 시도를 했었는데, 그 중 대표적인 장면이 중력을 이용해 책장에서 책을 낙하시키는 장면이다. 머피는 이를 수상하게 여기고 결국 ‘STAY’라는 메시지를 읽어냈다.

나는 다른 장면 중 먼지 폭풍이 지나간 자리에 먼지가 결을 이루며 쌓여 있는 장면에서 힌트를 얻었다. 구체적으로 어떤 신호를 전달한 것인지는 영화에선 나오지 않으나, 아래 그림과 같이 0과 1을 어떤 시각적 패턴으로 만들어 전달했음을 알 수 있다.

## 컨셉 구체화하기

### 실제 데이터를 비트(Bit)로 변환해 신호의 길고 짧음으로 표현해보자

그래서 미세먼지 데이터를 신호로 바라보기로 했다. 방법은 마찬가지로 2진 신호로 변환해보면 된다. 2진 신호는 켜지고 꺼지거나, 길고 짧거나 하는 형태가 연속적으로 일어난다. 대표적으로 모스 부호가 있다. 모스 부호는 신호의 길고 짧음을 점과 선으로 나타내며 이를 통해 신호를 문자로 인식할 수 있다. 아쉽게도 모든 문자와 숫자를 모스 부호로 표현할 수 없다는 한계가 있었다. 그래서 나는 모스부호의 원리를 차용해 신호의 길고 짧음으로 표현해보기로 했다.

### 데이터를 수집하고 분석해보자

컨셉이 잡혔으니 이제 데이터를 선택해보자. 패턴을 찾아가기 쉽도록 저는 특정 연도를 대상으로 하지 않고 2015년부터 2022년까지의 누적 통계를 찾기로 했다. 그리고 그 대상을 서울시로 선택했는데, 왜냐하면 서울은 전 세계에서 가장 미세먼지가 심한 곳 중 하나이기도 하고, 다른 지자체에 비해 데이터 누락이 적었기 때문이다. 그래서 2015년부터 2022년까지 서울시의 일별 대기오염 평균 데이터를 수집한 후, (초)미세먼지 데이터만 추출하여 하나의 스프레드시트로 병합했다.

결과적으로 서울시 자치구별 일자별 데이터를 모으고 병합하는 과정에서 데이터는 약 7만 개가 넘게 나오게 됐다. 하지만 패턴을 파악하기 위한 목적으로 보았을 때, 사용자에게 이를 모두 조회하게 허용하는 것은 아무 의미가 없었다. 그래서 데이터를 조회하는 기간에 따라 연도, 월, 주, 일, 요일 기준으로 묶었고, 이를 데이터베이스로 만들어 원하는 기준에 따라 조회할 수 있도록 서버를 구축했다.

오픈 데이터 -> 2015-2022 일자별 데이터(스프레드시트) -> 분석 및 추출(태블로) -> 그룹별 데이터(스프레드시트) -> 데이터베이스화(수파베이스)

### 기능 및 화면 설계하기

미세먼지 데이터는 측정 일자(기간)와 측정 수치를 핵심 속성으로 가진다. 이 두 속성을 바탕으로 사용자가 상호작용 가능한 인터페이스를 구상할 수 있었다.

#### 측정 일자(기간) -> 데이터 조회하기

사용자가 개발자가 미리 필터를 해놓은 추천 데이터셋을 선택하거나 직접 필터링해서 조회할 수 있도록 기능을 제공한다.

1. 프리셋 조회 설정 와이어프레임
2. 커스텀 조회 설정 와이어프레임

#### 측정 수치 -> 데이터를 그래픽과 사운드로 출력하기

먼저, 조회된 데이터셋에서 10진수인 미세먼지 측정값을 2진수로 변환하고, 이를 각 컴포넌트에서 그래픽과 사운드로 매핑한다. 그래픽은 너비가 길고 짧음을 통해 2진 신호를 표현한다. 사운드도 마찬가지로 비트로 변환한 데이터를 다음 방식으로 박자와 음정으로 매핑했다. 그리고 이를 피아노의 소리로 출력한다. 비트 1은 한 박자, 비트 0은 반 박자가 되며, 총 비트의 길이에 따라 G단조의 5음계를 옥타브와 함께 매핑한다. 그래서 수치가 높을수록 먼지가 더욱 쌓인 형태가 되고, 박자 마디가 길어지게 되어 더 길게 재생된다.

1. 데이터셋과 시퀀스, 데이터와 씬&비트 관계 와이어프레임
2. 높은 숫자와 낮은 숫자로 어떻게 시퀀스 내에서 씬이 되는지 와이어프레임
3. 플레이시 위 그림이 어떻게 음정(ex. C4)과 박자(ex. 음표)가 되는지 와이어프레임
4. 전체 화면 와이어프레임

## 구현하기

### 데이터 조회하기

쿼리 파라미터 ⎯⎯⎯⎯⎯⎯[데이터 스키마]⎯⎯⎯⎯⎯⎯⏐
정적 데이터 스키마 -> 폼 UI <-> 리액트훅폼 <-> 리액트쿼리 <-> 수파베이스 클라이언트 <-> 수파베이스

#### 특징 1

정적 데이터 스키마는 BFF 대용으로 사용되며 Map 형태로 해당 정적 데이터의 키와 값을 관리한다.

- 빌드시 데이터 스키마 인스턴스에 필요한 값을 요청해 입력받는다. ISR 방식으로 만들어 일주일마다 갱신한다.
- 모든 과정에서 키(Key)를 바탕으로 서버 데이터와 클라이언트의 상태를 검증하고, 필요에 따라 포매팅하여 출력한다.
- 폼 UI의 값과 폼 데이터의 기본 값을 생성할 때 사용한다.
- 각 스키마별 테스트코드

#### 특징 2

- 보통 전역 상태 관리는 Context API, Recoil, Redux 등을 사용하나, 이를 위한 보일러 플레이팅 과정과 URL 싱크를 맞추는 작업이 병행되어야 하기도 하고, 이 프로젝트에서 전역 상태는 쿼리 파라미터로만 보아도 충분하기에 사용하지 않았다.
- 전역 인스턴스인 next/navigation 모듈을 바탕으로 쿼리 파라미터를 전역 상태로 사용한다.
- next/navigation 모듈의 API를 바탕으로 래핑한 useQueryParam 훅 패밀리를 만들어 사용했다.
- 각 훅별 테스트코드

### 특징 3

- supabaseClient를 사용하면 응답되는 에러 응답 스키마는 정해져있다. 그래서 매번 쿼리 훅의 동적 타입으로 SupabaseError를 미리 타이핑해주고, 또 옵션 파라미터에서 suspense, useErrorBoundary 등 전역 설정을 오버라이드 하지 못하도록 래핑하여 isError, isLoading 등 옵션에 따라 의미 없는 리턴 값들을 컴포넌트에서 사용하지 못하도록하고 성공시 반환되는 응답 데이터를 리턴 값으로 선언하는 useSupabaseQuery 훅 패밀리를 만들어 사용했다.

### 특징 4

default 쿼리 파라미터 값에 따라 빌드시 정적 렌더링을 진행하고, 클라이언트에서 쿼리 파라미터에 따라 초기 화면을 새 데이터로 변경하여 퍼포먼스를 높힌다.

### 데이터를 그래픽과 사운드로 출력하기

(위 이미지 중간의 리액트쿼리부터 아래 방향으로) 리액트쿼리(캐시) -> (로딩시)로딩UI로 이관 -> (실패시)에러바운더리UI로 이관 -> (성공시)데이터 출력에 필요한 형태로 매핑 -> `<Sequence>` - `<Scene>` - `<Bit>`로 리스트 매핑

## 결과물

### 데이터 목록

- 조회한 데이터를 한 화면에 모아서 보기 위해 행과 열로 표현한다. 하나의 행이 하나의 데이터가 된다. 이를 통해서 전체적인 패턴을 파악하는데 도움을 줄 수 있다. (이미지)
- 각 아이템을 재생할 수 있다. (이미지)
- 전체 아이템을 재생할 수 있다. (이미지)
- 미리 설정된 데이터셋을 선택하거나, 커스텀해서 선택해올 수 있다. (이미지)
- 해당 화면을 그대로 공유할 수 있다. (공유 버튼 클릭 스크린샷)
- 데이터셋을 추출할 수 있다. (추출 버튼 클릭 스크린샷)

### 데이터 상세

- 아이템을 좀더 자세히 확대해서 본다는 컨셉으로 의도한 화면이다. 한 화면이 하나의 데이터가 된다. 길고 짧은 먼지가 쌓인 3차원 면적의 넓고 좁음을 통해 2진 신호를 표현했다. 이를 통해 개별 데이터가 가지는 신호 패턴을 더 집중해서 확인할 수 있다. (이미지)
- 아이템을 재생할 수 있다. (이미지)
- 해당 화면을 그대로 공유할 수 있다. (공유 버튼 클릭 스크린샷 + 공유된 후 전체 화면)
